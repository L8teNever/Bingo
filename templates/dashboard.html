{% extends "layout.html" %}

{% block content %}
<!-- Top App Bar -->
<header class="md-top-app-bar">
    {% if current_user.is_authenticated %}
    <button class="md-icon-button" onclick="toggleDrawer()">
        <span class="material-symbols-rounded">menu</span>
    </button>
    {% endif %}
    <div class="md-top-app-bar-title">Worteingabe</div>
    <div style="width: 48px;"></div> <!-- Spacer for centering -->
</header>

<main style="flex: 1; display: flex; flex-direction: column; padding: var(--spacing-lg); overflow-y: auto;">

    {% if is_dinner %}
    <!-- Voting Phase -->
    <div class="animate-in"
        style="text-align: center; padding-top: var(--spacing-xl); margin-bottom: var(--spacing-xl);">
        <div
            style="width: 80px; height: 80px; background: var(--md-tertiary-container); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; margin: 0 auto var(--spacing-lg); box-shadow: var(--md-shadow-2);">
            <span class="material-symbols-rounded"
                style="font-size: 40px; color: var(--md-on-tertiary-container);">how_to_vote</span>
        </div>
        <h1 style="margin-bottom: var(--spacing-md);">Abstimmung läuft!</h1>
        <p class="text-secondary" style="font-size: 16px; max-width: 320px; margin: 0 auto;">
            Welches Wort wurde bereits erwähnt? Vergib Punkte!
        </p>
    </div>

    {% if user_word %}
    <div class="md-card-filled animate-in"
        style="padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); text-align: center;">
        <p class="md-label" style="margin-bottom: var(--spacing-sm);">Dein Wort heute:</p>
        <div style="font-size: 24px; font-weight: 500; color: var(--md-primary);">{{ user_word.word }}</div>
    </div>
    {% endif %}

    <div class="md-card animate-in" style="padding: var(--spacing-lg); margin-bottom: auto;">
        <h3 class="md-label" style="margin-bottom: var(--spacing-lg);">Wer gewinnt heute?</h3>
        <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
            {% for w in all_words %}
            <div class="md-list-item"
                style="background: var(--md-surface-container-highest); justify-content: space-between;">
                <div style="flex: 1;">
                    <div style="font-weight: 500; margin-bottom: 4px;">{{ w.user.username }}</div>
                    <div class="text-primary" style="font-size: 14px;">"{{ w.word }}"</div>
                </div>
                <form action="{{ url_for('vote') }}" method="POST" style="margin: 0;">
                    <input type="hidden" name="voted_user_id" value="{{ w.user_id }}">
                    <button type="submit" class="md-button md-button-tonal">
                        <span class="material-symbols-rounded" style="font-size: 18px;">thumb_up</span>
                        <span>Punkt geben</span>
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
    </div>

    {% elif is_open %}
    <!-- Submission Phase -->
    <div class="animate-in"
        style="text-align: center; padding-top: var(--spacing-xl); margin-bottom: var(--spacing-xl);">
        <div class="animate-pulse"
            style="width: 80px; height: 80px; background: var(--md-primary-container); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; margin: 0 auto var(--spacing-lg); box-shadow: var(--md-shadow-2);">
            <span class="material-symbols-rounded"
                style="font-size: 40px; color: var(--md-on-primary-container);">lightbulb</span>
        </div>
        <h1 style="margin-bottom: var(--spacing-md);">Dein Bingo-Wort</h1>
        <p class="text-secondary" style="font-size: 16px; max-width: 320px; margin: 0 auto;">
            Wähle ein Wort, das heute sicher erwähnt wird.
        </p>
    </div>

    <!-- Word Input Card -->
    <div class="md-card-elevated animate-in" style="padding: var(--spacing-xl); margin-bottom: var(--spacing-lg);">
        <form id="word-form" action="{{ url_for('submit_word') }}" method="POST">
            <div class="md-input-container" style="margin-bottom: 0;">
                <label class="md-label">Dein Wort</label>
                <input type="text" name="word" id="bingo-word" class="md-input-filled"
                    placeholder="Was wird heute gesagt?" value="{{ user_word.word if user_word else '' }}"
                    style="font-size: 20px; font-weight: 500; text-align: center; padding: var(--spacing-lg);"
                    autocomplete="off">
            </div>
        </form>
    </div>

    {% if user_word and all_words|length >= 1 %}
    <!-- Other Participants -->
    <div class="md-card animate-in" style="padding: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
        <h3 class="md-label" style="margin-bottom: var(--spacing-lg);">Andere Teilnehmer</h3>
        <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
            {% for w in all_words %}
            {% if w.user_id != current_user.id %}
            <div class="md-list-item" style="justify-content: space-between; padding: var(--spacing-md) 0;">
                <span class="text-secondary">{{ w.user.username }}</span>
                <span class="text-primary font-medium">{{ w.word }}</span>
            </div>
            {% if not loop.last %}
            <div class="md-divider" style="margin: 0;"></div>
            {% endif %}
            {% endif %}
            {% endfor %}
            {% if all_words|length == 1 %}
            <p class="text-secondary text-center" style="padding: var(--spacing-lg) 0; font-size: 14px;">
                Du bist der Erste! Warte auf andere Teilnehmer...
            </p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <div style="margin-bottom: auto;"></div>

    {% else %}
    <!-- Waiting Phase -->
    <div class="animate-in"
        style="text-align: center; padding-top: var(--spacing-2xl); margin-bottom: var(--spacing-xl);">
        <div
            style="width: 80px; height: 80px; background: var(--md-surface-container-highest); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; margin: 0 auto var(--spacing-lg);">
            <span class="material-symbols-rounded"
                style="font-size: 40px; color: var(--md-on-surface-variant);">bedtime</span>
        </div>
        <h1 style="margin-bottom: var(--spacing-md);">Noch etwas Geduld...</h1>
        <p class="text-secondary" style="font-size: 16px; max-width: 320px; margin: 0 auto;">
            Die Worteingabe startet um {{ notify_time }} Uhr.
        </p>
    </div>
    {% endif %}
</main>

<!-- Footer Actions -->
<footer
    style="padding: var(--spacing-lg); background: var(--md-surface); border-top: 1px solid var(--md-outline-variant);">
    {% if is_open %}
    {% if not user_word %}
    <!-- Submit Button -->
    <button type="button" onclick="document.getElementById('word-form').submit()"
        class="md-button md-button-filled w-full" style="height: 56px; font-size: 16px;">
        <span>Wort Einreichen</span>
        <span class="material-symbols-rounded">arrow_forward</span>
    </button>
    {% else %}
    <!-- Word Submitted Confirmation -->
    <div class="md-card-filled"
        style="padding: var(--spacing-md); margin-bottom: var(--spacing-md); text-align: center;">
        <div
            style="display: flex; align-items: center; justify-content: center; gap: var(--spacing-sm); color: var(--md-success);">
            <span class="material-symbols-rounded">check_circle</span>
            <span class="font-medium">Wort eingereicht</span>
        </div>
    </div>
    <!-- Withdraw Button -->
    <form action="{{ url_for('withdraw_word') }}" method="POST">
        <button type="submit" class="md-button md-button-outlined w-full"
            style="height: 48px; border-color: var(--md-error); color: var(--md-error);">
            <span class="material-symbols-rounded">close</span>
            <span>Wort zurückziehen</span>
        </button>
    </form>
    {% endif %}
    {% endif %}

    <p class="text-secondary text-center" style="font-size: 12px; margin-top: var(--spacing-md);">
        Du spielst als <span class="font-medium">{{ current_user.username }}</span>
    </p>
</footer>
{% endblock %}