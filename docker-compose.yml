version: '3.8'

services:
  bingo:
    build: .
    image: l8tenever/bingo:latest
    container_name: dinner_bingo
    ports:
      - "5007:5000"
    environment:
      - SECRET_KEY=${SECRET_KEY:-bingo-secret-key-123}
      - FLASK_ENV=production
      # Benutzer automatisch erstellen beim Start
      # Format: username:password:role,username:password:role,...
      # Rolle: player oder admin
      - USERS=admin:admin123:admin,max:geheim123:player,anna:test456:player
    volumes:
      # WICHTIG: Das Volume sorgt dafür, dass die Datenbank (Benutzer, Punkte etc.) 
      # auch nach einem Container-Update erhalten bleibt.
      #
      # Option 1: Named Volume (empfohlen für Production)
      # Vorteil: Docker verwaltet die Daten, funktioniert auf allen Plattformen
      - bingo-data:/app/instance
      #
      # Option 2: Bind Mount (gut für Entwicklung/Backup)
      # Vorteil: Direkter Zugriff auf Datenbank-Datei im Projektordner
      # Wenn Sie diese Option nutzen möchten, kommentieren Sie die Zeile oben aus
      # und entfernen Sie das # vor der nächsten Zeile:
      # - ./instance:/app/instance
    restart: always
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:5000/" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  bingo-data:
    driver: local
